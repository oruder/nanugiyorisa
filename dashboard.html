<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ë‚˜ëˆ„ê¸° ìš”ë¦¬ì‚¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .password-modal.hidden {
            display: none;
        }
        
        .password-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }
        
        .password-content h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .password-content input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .password-content button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .password-content button:hover {
            opacity: 0.9;
        }
        
        .error-message {
            color: red;
            margin-top: 10px;
            font-size: 14px;
        }
        
        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .dashboard-header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .users-table {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            overflow-x: auto;
        }
        
        .users-table h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #667eea;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .refresh-btn:hover {
            opacity: 0.9;
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .back-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div class="password-modal" id="passwordModal">
        <div class="password-content">
            <h2>ğŸ”’ ê´€ë¦¬ì ì¸ì¦</h2>
            <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            <button id="loginBtn">ë¡œê·¸ì¸</button>
            <div class="error-message" id="errorMessage"></div>
        </div>
    </div>
    
    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div class="dashboard" id="dashboard" style="display: none;">
        <div class="dashboard-header">
            <h1>ğŸ“Š ë‚˜ëˆ„ê¸° ìš”ë¦¬ì‚¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì‚¬ìš©ì í™œë™ í˜„í™© ë° í†µê³„</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ì´ ì‚¬ìš©ì ìˆ˜</h3>
                <div class="value" id="totalUsers">0</div>
            </div>
            <div class="stat-card">
                <h3>ì´ ë§¤ì¶œ</h3>
                <div class="value" id="totalMoney">0ì›</div>
            </div>
            <div class="stat-card">
                <h3>í‰ê·  ë§¤ì¶œ</h3>
                <div class="value" id="avgMoney">0ì›</div>
            </div>
            <div class="stat-card">
                <h3>ìµœê³  ë§¤ì¶œ</h3>
                <div class="value" id="maxMoney">0ì›</div>
            </div>
        </div>
        
        <div class="users-table">
            <h2>ì‚¬ìš©ì ëª©ë¡ <span style="color: #28a745; font-size: 14px;">ğŸŸ¢ ì‹¤ì‹œê°„</span></h2>
            <button class="back-btn" onclick="location.href='index.html'">ğŸ  ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            <table>
                <thead>
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ì‚¬ìš©ìëª…</th>
                        <th>ë§¤ì¶œ</th>
                        <th>ë§ˆì§€ë§‰ ì ‘ì†</th>
                        <th>ì´ ê²Œì„ ìˆ˜</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center;">ë°ì´í„° ë¡œë”© ì¤‘...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDjHaq4tZvTC9IFxSK_M_yZg4WguyUh_NI",
            authDomain: "nanugiyorisa.firebaseapp.com",
            projectId: "nanugiyorisa",
            storageBucket: "nanugiyorisa.firebasestorage.app",
            messagingSenderId: "297540232572",
            appId: "1:297540232572:web:7eb1d80fec640e34b5b0f9"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const PASSWORD = '20254141';
        let isAuthenticated = false;
        
        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        document.getElementById('loginBtn').addEventListener('click', checkPassword);
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });
        
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === PASSWORD) {
                isAuthenticated = true;
                document.getElementById('passwordModal').classList.add('hidden');
                document.getElementById('dashboard').style.display = 'block';
                loadDashboardData();
            } else {
                document.getElementById('errorMessage').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤';
            }
        }
        
        // ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
        function loadDashboardData() {
            try {
                const usersRef = collection(db, 'users');
                const q = query(usersRef, orderBy('money', 'desc'));
                
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                onSnapshot(q, (querySnapshot) => {
                    const users = [];
                    querySnapshot.forEach((doc) => {
                        users.push(doc.data());
                    });
                    
                    // í†µê³„ ê³„ì‚°
                    const totalUsers = users.length;
                    const totalMoney = users.reduce((sum, user) => sum + (user.money || 0), 0);
                    const avgMoney = totalUsers > 0 ? Math.round(totalMoney / totalUsers) : 0;
                    const maxMoney = users.length > 0 ? users[0].money || 0 : 0;
                    
                    // í†µê³„ í‘œì‹œ
                    document.getElementById('totalUsers').textContent = totalUsers;
                    document.getElementById('totalMoney').textContent = totalMoney.toLocaleString() + 'ì›';
                    document.getElementById('avgMoney').textContent = avgMoney.toLocaleString() + 'ì›';
                    document.getElementById('maxMoney').textContent = maxMoney.toLocaleString() + 'ì›';
                    
                    // í…Œì´ë¸” í‘œì‹œ
                    const tbody = document.getElementById('usersTableBody');
                    tbody.innerHTML = '';
                    
                    if (users.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                        return;
                    }
                    
                    users.forEach((user, index) => {
                        const row = document.createElement('tr');
                        const lastPlayed = user.lastPlayed ? new Date(user.lastPlayed).toLocaleString('ko-KR') : 'ì—†ìŒ';
                        const totalGames = user.totalGames || 0;
                        
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td><strong>${user.username}</strong></td>
                            <td>${(user.money || 0).toLocaleString()}ì›</td>
                            <td>${lastPlayed}</td>
                            <td>${totalGames}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    console.log('ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸:', users.length + 'ëª…');
                }, (error) => {
                    console.error('ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('usersTableBody').innerHTML = 
                        '<tr><td colspan="5" style="text-align: center; color: red;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message + '</td></tr>';
                });
                
            } catch (error) {
                console.error('ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹¤íŒ¨:', error);
                document.getElementById('usersTableBody').innerHTML = 
                    '<tr><td colspan="5" style="text-align: center; color: red;">ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹¤íŒ¨: ' + error.message + '</td></tr>';
            }
        }
    </script>
</body>
</html>
